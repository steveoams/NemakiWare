general:
  branches:
    only:
      - master
      - integration
      - topic_test

machine:
  timezone: Asia/Tokyo
  hosts:
    localhost: 127.0.0.1
  services:
    - couchdb

test:
  pre:
    - sudo service couchdb start
  override:
    - mvn -f /home/ubuntu/NemakiWare/setup/couchdb/bjornloka package
    - java -cp /home/ubuntu/NemakiWare/setup/couchdb/bjornloka/target/bjornloka.jar jp.aegif.nemaki.bjornloka.Load http://127.0.0.1:5984 bedroom /home/ubuntu/NemakiWare/setup/couchdb/initial_import/bedroom_init.dump true
    - java -cp /home/ubuntu/NemakiWare/setup/couchdb/bjornloka/target/bjornloka.jar jp.aegif.nemaki.bjornloka.Load http://127.0.0.1:5984 bedroom_closet /home/ubuntu/NemakiWare/setup/couchdb/initial_import/archive_init.dump true
    - java -cp /home/ubuntu/NemakiWare/setup/couchdb/bjornloka/target/bjornloka.jar jp.aegif.nemaki.bjornloka.Load http://127.0.0.1:5984 canopy /home/ubuntu/NemakiWare/setup/couchdb/initial_import/bedroom_init.dump true
    - java -cp /home/ubuntu/NemakiWare/setup/couchdb/bjornloka/target/bjornloka.jar jp.aegif.nemaki.bjornloka.Load http://127.0.0.1:5984 canopy_closet /home/ubuntu/NemakiWare/setup/couchdb/initial_import/archive_init.dump true
    - mvn install -f /home/ubuntu/NemakiWare/common
    - mvn verify -P product -f /home/ubuntu/NemakiWare/core
  post:
    - mkdir -p $CIRCLE_TEST_REPORTS/junit/
    - find . -type f -regex ".*/target/surefire-reports/.*xml" -exec cp {} $CIRCLE_TEST_REPORTS/junit/ \;